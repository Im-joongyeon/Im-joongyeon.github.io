# 3. 결론 및 후기

## 개선한 점

### 안정화

Airflow를 통해 process간의 영향이 있는건 기다렸다가 처리하는 등의 조치를 취하고, 실패한 Process는 Retry로직을 수행 후에 추가 실행되도록 프로세스를 구성하였다. 이로 인해 장애율이 급감하였습니다. 월 5 회 정도 데이터 이슈가 생겼는데요 마이그레이션 이후에는 1 \~ 2회 미만으로 줄었습니다.

수 많은 로그들을 airflow Ui를 통해서 확인 할 수 있고, 추후에는 airflow에서 process가 실패할 때 Slack 알람을 받도록 기능을 추가해서 실패하면 로그 확인 ⇒ 오류 발생 지점 확인(process)  ⇒ 디버깅 ⇒ 조치 까지 걸리는 시간이 단축되었습니다. 기존에는 장애가 터지면 2시간정도 걸렸는데 평균적으로 30분 이내로 단축되었습니다.

Freshness및 검증로직 그리고 테스트 기능이 기본 내장되어 있어서 데이터의 품질이 향상되었습니다.

### 생산성

모델간의 관계 추적을 위해 일일이 사람이 수기로 기록하지 않아도 되었고, 쿼리 기반이라 부가적인 코딩 로직에 의한 실수가 줄어들었습니다. 컴파일에 실패할 일도 없어지고 그로 인해 생산성이 증가했습니다. \
대략적으로 3 \~ 4일 정도 걸리는 개발이 1 \~ 2일로 단축되었습니다.

## 사용 해보니 아쉬운 점

### 인덱스

DBT모델에 의해 자동으로 생성된 테이블에는 버그때문인지 실제로 명세했던 Index가 걸리지 않는 문제가 있었습니다. 이로 인해 추가 프로세스를 통해서 처리해주어야 했습니다.

### Delete및 Upsert

DBT는 데이터 모델링과 Insert에 집중되어 있습니다. Delete 및 Upsert 기능이 없기 때문에 잘못된 데이터가 Insert된다면, 기존 쿼리는 수정하지 않으면서 잘못된 특정 Row만 Delete또는 Upsert해줄 별도의 로직이 필요했습니다.

### 방언

파이썬계열의 Jinja2문법과 SQL문이 합쳐져서 새로운 방언이 탄생했다 라는 느낌을 받았고, 이는 학습곡선이 다른 SQL보다 높게 느껴졌습니다. 요즘은 AI 잘 활용하면 이건 문제가 되지 않을 것 같기도 합니다.



## 마치며

DBT와 Airflow로 마이그레이션 하면서 비지니스 로직을 벗어나 데이터 품질과 운영에 집중 할 수 있게 되었습니다.\
이 변화로 지표 개발에 대한 확장성을 얻을 수 있었다고 생각합니다. 또한 보다 효율적인 운영의 기틀을 마련했다고 생각합니다.

이상으로 DBT와 Airflow 도입기를 마치겠습니다.
